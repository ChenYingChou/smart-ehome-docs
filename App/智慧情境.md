# 智慧情境
依據現場設備功能狀態反應，當達到所預期的設置，進行該設置的場景模式。
以下以居家常用的幾種運用場景，作為設計參考範例。

[[TOC]]

## 節能系列

### 玄關節能
對於玄關照明的要求，通常運用於外出或回家時，當人位於玄關處時，自動開啟照明，等穿好外出鞋或換穿室內鞋後，離開此處後約30秒關燈，達到節能目的。

相關IO:
```sh
玄關燈：要控制的燈光迴路。
玄關感測器：該感測功能主要用來偵測玄關處有人。
```

設置步驟：
1. 新增：智慧情境，名稱為「玄關感測節能」
2. 新增：狀態表達，名稱為「玄關感測狀態」
3. 「前門感測狀態」內，新增：條件表達，名稱為「玄關感測 ON」
- 條件表達： 玄關感測 == ON 持續 0 秒
- 下個狀態： 繼續
- 間格時間(秒)： 10
- 動作清單： 玄關燈 ON
4. 「前門感測狀態」內，新增：條件表達「玄關感測 OFF」
- 條件表達： 玄關感測 == OFF 持續 30 秒
- 下個狀態： 繼續
- 間格時間(秒)： 10
- 動作清單： 玄關燈 OFF

Demo:
> step.1
![](https://i.imgur.com/u2Dtelu.png)

> step.2
![](https://i.imgur.com/0KgbZck.png)

> step.3
![](https://i.imgur.com/xtathpR.png)

> step.4
![](https://i.imgur.com/PxCasEO.png)

### 廁所節能
有時如廁後，會有忘記關燈的狀況，透過此設置，當該迴路燈光開啟一定時間後，將自動關閉，避免無謂耗電。

相關IO:
```sh
廁所燈 ： 要控制的燈光迴路
```
設置步驟：
1. 新增：智慧情境，名稱為「廁所節能」
2. 新增：狀態表達，名稱為「廁所燈光狀態」
3. 「廁所燈光狀態」內，新增：條件表達，名稱為「廁所燈光 ON」
- 條件表達： 廁所燈光 == ON 持續 2400 秒 (40分鐘)
- 下個狀態： 繼續
- 間格時間(秒)： 10
- 動作清單： 廁所燈光 OFF

### 智慧節能提醒
當燈光開啟一段時間後，會發出推播訊息，提醒該燈光尚未關閉。
> 有可能忘記關燈場所（廁所）
> 或廁所內發生意外事故

相關IO:
```sh
廁所燈 ： 要檢查的燈光迴路
```
設置步驟：
1. 新增：智慧情境，名稱為「智慧節能提醒」
2. 新增：狀態表達，名稱為「廁所燈光狀態」
3. 「廁所燈光狀態」內，新增：條件表達，名稱為「廁所燈光 ON」
- 條件表達： 廁所燈光 == ON 持續 2400 秒 (40分鐘)
- 下個狀態： 繼續
- 間格時間(秒)： 10
- 動作清單： 送出訊息「廁所燈已開啟40分，是否未關燈或有事故發生」

## 關懷系列

### 關懷獨居長輩運用
對於獨居的長輩，除定期探訪外，我們可以透過以下設置，當所設置時間內，長輩若尚未回到家中，則進行推播訊息通知。

設置步驟：
Demo:



## 保全系列

### 大門進出通知
進出入大門時，會發出推播訊息通知

相關IO:
```sh
大門磁簧感測
玄關P感測(PIR)
```
設置步驟：
1. 新增：智慧情境，名稱為「大門進出通知」
2. 新增：狀態表達 (S1)，名稱為「初始化」
3. 新增：狀態表達 (S2)，名稱為「大門偵測中」
4. 新增：狀態表達 (S3)，名稱為「外出確認」
5. 新增：狀態表達 (S4)，名稱為「感測賦歸中」
6. (S1)「初始化」內
    - 新增：條件表達（T1)，名稱為「功能啟動通知」
        - 條件表達： self == ON 持續 0 秒 
        - 下個狀態： 「大門偵測中」(S2)
        - 間格時間(秒)： 0
        - 動作清單： 送出訊息「人員進出通知ON(智慧場景)」

7. (S2)「大門偵測中」內
    - 新增：條件表達（T1)，名稱為「大門已打開」
        - 條件表達： 大門磁簧感測 == ON 持續 0 秒 
        - 下個狀態： 「外出確認」(S3)
        - 間格時間(秒)： 0
        - 動作清單： 無

    - 新增：條件表達（T2)，名稱為「功能結束通知」
        - 條件表達： self == Off 持續 0 秒 
        - 下個狀態： 繼續
        - 間格時間(秒)： 0
        - 動作清單： 送出訊息「人員進出通知OFF(智慧場景)」

8. (S3)「外出確認」內
    - 新增：條件表達（T1)，名稱為「玄關感測ON」
        - 條件表達： 玄關感測 == ON 持續 0 秒 
        - 下個狀態： 「感測賦歸中」(S3)
        - 間格時間(秒)： 0
        - 動作清單： 送出訊息「人員外出」

    - 新增：條件表達（T2)，名稱為「玄關感測OFF」
        - 條件表達： 玄關感測 == OFF 持續 0 秒 
        - 下個狀態： 「感測賦歸中」(S3)
        - 間格時間(秒)： 0
        - 動作清單： 送出訊息「人員已進出入(智慧場景)」

9. (S4)「感測賦歸中」內
    - 新增：條件表達（T1)，名稱為「大門復歸」
        - 條件表達： 大門磁簧感測 == OFF 持續 5 秒 
        - 下個狀態： 「繼續」
        - 間格時間(秒)： 0
        - 異常訊息： 大門復歸-OK

    - 新增：條件表達（T2)，名稱為「玄關感測復歸」
        - 條件表達： 大門磁簧感測 == OFF 持續 5 秒 
        - 下個狀態： 「繼續」
        - 間格時間(秒)： 0
        - 異常訊息： 玄關感測復歸-OK

    - 新增：條件表達（T3)，名稱為「復歸-OK」
        - 條件表達： errors == 2 持續 0 秒 
        - 下個狀態： 「大門偵測中」
        - 間格時間(秒)： 0


### 夜間門禁(家中青少年)
當門禁時，家中青少年利用父母已睡的機會，偷偷外出，經由此設置，當家中青少年外出或回來時，可以收到訊息推播通知。

相關IO:
```sh
大門磁簧感測
玄關P感測(PIR)
```
設置步驟：
1. 新增：智慧情境，名稱為「夜間門禁」
2. 新增：狀態表達 (S1)，名稱為「大門偵測中」
3. 新增：狀態表達 (S2)，名稱為「外出確認」
4. 新增：狀態表達 (S3)，名稱為「感測賦歸中」
5. (S1)「大門偵測中」內
    - 新增：條件表達（T1)，名稱為「大門已打開」
        - 條件表達： 大門磁簧感測 == ON 持續 0 秒 
        - 下個狀態： 「外出確認」(S2)
        - 間格時間(秒)： 0
        - 動作清單： 無

6. (S2)「外出確認」內
    - 新增：條件表達（T1)，名稱為「玄關感測ON」
        - 條件表達： 玄關感測 == ON 持續 0 秒 
        - 下個狀態： 「感測賦歸中」(S3)
        - 間格時間(秒)： 0
        - 動作清單： 送出訊息「有人偷溜囉！」

    - 新增：條件表達（T2)，名稱為「玄關感測OFF」
        - 條件表達： 玄關感測 == OFF 持續 5 秒 
        - 下個狀態： 「感測賦歸中」(S3)
        - 間格時間(秒)： 0
        - 動作清單： 送出訊息「有人偷偷回來啦！」

7. (S3)「感測賦歸中」內
    - 新增：條件表達（T1)，名稱為「大門復歸」
        - 條件表達： 大門磁簧感測 == OFF 持續 5 秒 
        - 下個狀態： 「繼續」
        - 間格時間(秒)： 0
        - 異常訊息： 大門復歸-OK

    - 新增：條件表達（T2)，名稱為「玄關感測復歸」
        - 條件表達： 玄關感測 == OFF 持續 5 秒 
        - 下個狀態： 「繼續」
        - 間格時間(秒)： 0
        - 異常訊息： 玄關感測復歸-OK

    - 新增：條件表達（T3)，名稱為「復歸-OK」
        - 條件表達： errors == 2 持續 0 秒 
        - 下個狀態： 「大門偵測中」
        - 間格時間(秒)： 0


### 保全
透過下列設置，當啟動保全或關閉保全時，會收到訊息通知該功能已啟動/關閉，當異常入侵時，也會收到相關觸發點的推播訊息通知。

相關IO:
```sh
大門磁簧感測
客廳落地窗磁簧感測
主臥窗戶磁簧感測
後陽台窗戶磁簧感測
室內音波感測
警鈴
```

設置步驟：
1. 新增：智慧情境，名稱為「智慧保全」
2. 新增：狀態表達 (S1)，名稱為「初始化檢查」
3. 新增：狀態表達 (S2)，名稱為「保全執行中」
4. (S1)「初始化檢查」內
    - 新增：條件表達（T1)，名稱為「大門磁簧」
        - 條件表達： 大門磁簧感測 == ON 持續 0 秒 
        - 下個狀態： 「繼續」
        - 間格時間(秒)： 0
        - 異常訊息： 大門未關閉

    - 新增：條件表達（T2)，名稱為「客廳落地窗」
        - 條件表達： 客廳落地窗磁簧感測 == ON 持續 0 秒 
        - 下個狀態： 「繼續」
        - 間格時間(秒)： 0
        - 異常訊息： 客廳落地窗未關閉

    - 新增：條件表達（T3)，名稱為「主臥窗戶」
        - 條件表達： 主臥窗戶磁簧感測 == ON 持續 0 秒 
        - 下個狀態： 「繼續」
        - 間格時間(秒)： 0
        - 異常訊息： 主臥窗戶未關閉

    - 新增：條件表達（T4)，名稱為「後陽台窗戶」
        - 條件表達： 後陽台窗戶磁簧感測 == ON 持續 0 秒 
        - 下個狀態： 「繼續」
        - 間格時間(秒)： 0
        - 異常訊息： 後陽台窗戶未關閉

    - 新增：條件表達（T5)，名稱為「異常狀態持續30秒」
        - 條件表達： errors > 0 持續 30 秒 
        - 下個狀態： 「繼續」
        - 間格時間(秒)： 0
        - 動作清單： 送出訊息「保全啟動失敗：檢測門窗未關閉！」

    - 新增：條件表達（T6)，名稱為「通過檢查，無錯誤持續30秒」
        - 條件表達： errors == 0 持續 30 秒 
        - 下個狀態： 「保全執行中」
        - 間格時間(秒)： 0
        - 動作清單： 
                  - 控制 燈光全關
                  - 送出訊息「保全已啟動」

5. (S2)「保全執行中」內
    - 新增：條件表達（T1)，名稱為「大門磁簧」
        - 條件表達： 大門磁簧感測 == ON 持續 0 秒 
        - 下個狀態： 「繼續」
        - 間格時間(秒)： 30
        - 異常訊息： 入侵警報：大門
        - 動作清單： 送出訊息「入侵警報：大門」

    - 新增：條件表達（T2)，名稱為「客廳落地窗」
        - 條件表達： 客廳落地窗磁簧感測 == ON 持續 0 秒 
        - 下個狀態： 「繼續」
        - 間格時間(秒)： 30
        - 異常訊息： 入侵警報：客廳落地窗
        - 動作清單： 送出訊息「入侵警報：客廳落地窗」

    - 新增：條件表達（T3)，名稱為「主臥窗戶」
        - 條件表達： 主臥窗戶磁簧感測 == ON 持續 0 秒 
        - 下個狀態： 「繼續」
        - 間格時間(秒)： 30
        - 異常訊息： 入侵警報：主臥窗戶
        - 動作清單： 送出訊息「入侵警報：主臥」

    - 新增：條件表達（T4)，名稱為「後陽台窗戶」
        - 條件表達： 後陽台窗戶磁簧感測 == ON 持續 0 秒 
        - 下個狀態： 「繼續」
        - 間格時間(秒)： 30
        - 異常訊息： 入侵警報：後陽台窗戶
        - 動作清單： 送出訊息「保入侵警報：後陽台」

    - 新增：條件表達（T5)，名稱為「室內音波感測」
        - 條件表達： 室內音波感測 == ON 持續 0 秒 
        - 下個狀態： 「繼續」
        - 間格時間(秒)： 30
        - 異常訊息： 入侵警報：室內音波感測
        - 動作清單： 送出訊息「入侵警報：室內音波感測」

    - 新增：條件表達（T5)，名稱為「同時兩項以上異常發生，觸發警鈴響10秒」
        - 條件表達： errors >= 2 持續 0 秒 
        - 下個狀態： 「繼續」
        - 間格時間(秒)： 15
        - 動作清單： 
                  - 控制 警鈴ON
                  - 控制 警鈴OFF (延遲10s)

