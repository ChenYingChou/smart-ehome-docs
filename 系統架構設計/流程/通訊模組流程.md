## 通訊模組流程

1. 註冊 (MQTT):
    1. 取得本地伺服器 Key, 若通訊模組建置在本地伺服器則可自動取得 (需有讀取權限)。
    1. 送出註冊訊息，含本模組的各項設備/功能的基本資訊。
    1. 接收註冊回應，取得本地唯一模組 ID 及 Token。

1. 解除註冊 (MQTT):
    1. 送出解除註冊訊息。
    1. 接收回應。

1. 模組啟動/結束:
    1. 若通訊模組同在本地伺服器時必須具備啟動及結束程序，本系統服務初始化時會逐一執行各註冊模組的啟動程序，服務關閉時執行各模組的結束程序。
    1. 在系統服務關閉時亦會發出結束訊息 (MQTT)。對在本地伺服器外的通訊模組而言會中斷連線，此時通訊模組可以每分鐘嘗試再度連接本地伺服器，直到連線成功為止。

1. 模組異動 (MQTT):
    1. 系統模組 (情境、智慧控制、排程): 有增刪改時發出異動通知，版本號碼加 1
        * 情境、智慧控制、排程內容較複雜，要如何與執行中的管理系統交換內容?
        * 若情境、智慧控制、排程正在執行中，是否應先停止，重新載入相關設定組態後重新執行?
    2. 一般通訊模組通知異動: 版本號碼加 1
        * 管理系統依組態更新。
        * Apps 收到模組更新 (或在程式啟動時比對版本) 時，自行決定是否通知使用者立即處理或延後處理。
        * 刪除設備/功能可能影響情境、智慧控制、排程內容，亦會影響用戶 UI 介面呈現狀態。至於如何處理留給 Apps 設計者處理。

