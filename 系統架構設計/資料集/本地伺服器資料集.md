本地伺服器資料集
---

1. 模組註冊資料:

    ```js
    "modules": {
        "__模組ID__": {
            "name": "**模組名稱**",
            "devices": {                        // 設備物件
                "**設備ID**": {
                    "name": "**設備名稱**",
                    "functions": {              // 功能物件
                        "**功能ID**": {
                            "name": "**功能名稱**",
                            "type": 1,              // 輸入(狀態):1, 輸出(控制):2, 輸出入:3
                            "value": "__Value__",   // 1, 2, 3, 100/n, n1~n2
                            "ui": "__UI__",         // UI 元件
                            "keep_last": 1,         // 記錄最近多少秒的狀態值: 1~3600 (指系統內部，非資料庫儲存)
                            "status": [],           // 內部記錄: 最後 keep_last 秒的狀態值
                            "last_stamp": 0         // milliseconds since 01 January, 1970 UTC (54 bits)
                        },
                        // 其他功能...
                    }
                },
                // 其他設備...
            },
            "key": "**16 個隨機字元轉十六進位字串, 共 32 HEX 字元**",
            "token": "__身份驗證令牌__"
        },
        // 其他模組...
    }
    ```

1. 儲存雲端伺服器通訊所需資料:

    ```js
    "server": {
        "s_id": "__自定伺服器ID__",
        "key": "**16 個隨機字元轉十六進位字串, 共 32 HEX 字元**",
        "token": "__身份驗證令牌__"
    }
    ```

1. 情境:

    ```js
    <action> {
        "id": "**模組ID+設備ID+功能ID**",
        "delay": 0,                 // 執行前延遲時間，精確度 0.1 秒
        "value": "**值**"
    }

    "scenes": {
        "**情境ID**": [             // actions: 依順序執行
            <action>,
            // 其他 action ...
        ],
        // 其他情境...
    }
    ```

    * 同一情境重複執行時會先中止先前的才開始執行。
    <br>

1. 智慧控制:

    ```js
    <node> {        // 運算後返回值 -- 0:失敗, 1:成功但持續時間未滿足, 2:成功且已滿足持續時間
        "op": "",                   // '+','-','*','/',('<','>','='),'&','|','^','&&','||','!'
                                    // 函數 mean,max,min,median: left=變數, right=最近多少筆
        "left": <node>,             // 變數 $1~$n, 或左 Node
        "right": <node>,            // 變數 $1~$n, 或右 Node
        "duration": 0,              // 要求持續時間 (精確度 0.1 秒)
        "elapsed": 0                // 已持續時間 (精確度 0.1 秒)
    }

    "wisdoms": {    // 智慧控制物件
        "**智慧控制ID**": {
            "active": true,                     // 啟用或停用
            "states": [ "**狀態ID**", ... ],    // 依順序執行狀態機
            "current": -1,                      // 目前狀態機索引: states[current]
            "root": <node>                      // 目前狀態機條件運算分析樹
        },
        // 其他智慧控制...
    }

    "states": {     // 狀態機物件
        "**狀態機ID**": {
            "condition": {          // 要滿足的條件
                "vars": [ "**模組ID+設備ID+功能ID**", ... ],
                "expr": "**條件運算式**"         // 以 `$1~$n` 表示對應 vars[] 的 `模組ID+設備ID+功能ID` 狀態值
            },
            "run": {                // 滿足條件後執行命令
                "actions": [        // 依順序執行
                    <action>,
                    // 其他 action ...
                ],
                "scenses": [ "**情境ID**", ... ]
            },
            "delay": 0              // 延遲時間之後才結束本狀態機，精確度 0.1 秒
        },
        // 其他狀態機...
    }
    ```

    * 智慧控制的 `active` 設為 `false` 表示平常停用，但在排程指定的時間範圍內會自動啟用之。
    * `條件運算式` 中可含 `:duration` 表示該運算式需持續滿足多少秒 (精確度 0.1 秒)。
    * 狀態機 `run` 中的 `actions`、`scenses` 同時存在的話，會以併行方式開始執行。
    * 狀態機 `delay` 是指 `run` 開始執行起計算的延遲時間，並非 `run` 執行完後的延遲時間。
    <br>

1. 排程:

    ```js
    "schedules" : {
        "**排程ID**": {
            "active": true,         // 是否啟用
            "timer": {
                "date_start": "",   // YYYY-MM-DD: 起始日期
                "date_end": "",     // YYYY-MM-DD: 結束日期
                "weeks": [],        // 0~6: 週日~週六
                "months": [],       // 1~12 月
                "days": [],         // 1~31 日
                "hours": [],        // 0~23 時
                "minutes": []       // 0~59 分
            },
            "run": {
                "actions": [        // 依順序執行
                    <action>,
                    // 其他 action ...
                ],
                "scenses": [ "**情境ID**", ... ],
                "wisdoms": [ "**智慧控制ID**", ... ]
            }
        },
        // 其他排程...
    }
    ```

    * `timer` 中的 (`date_start`, `date_end`, `days`, `weeks`, `hours`) 可以省略或以空值表示之。
    * `timer.minutes` 至少要指定一個值。
    * `run` 至少要指定 `actions`、`scenses`、`wisdoms` 其中一項。
    * `run.wisdoms` 表示在指定的時間範圍啟用。

