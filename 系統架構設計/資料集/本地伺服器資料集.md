本地伺服器資料集
---

1. 模組註冊資料:

    ```js
    "modules": {
        "__模組ID__": {
            "name": "**模組名稱**",
            "devices": {                        // 設備物件
                "**設備ID**": {
                    "name": "**設備名稱**",
                    "functions": {              // 功能物件
                        "**功能ID**": {
                            "name": "**功能名稱**",
                            "type": 1,              // 輸入(狀態):1, 輸出(控制):2, 輸出入:3
                            "value": "__Value__",   // 1, 2, 3, 100/n, n1~n2
                            "ui": "__UI__",         // UI 元件
                            "status": "last value", // 內部記錄: 最後的狀態或設定值
                            "duration": 0           // last value 已持續多久，單位: 1/10 秒
                        },
                        // 其他功能...
                    }
                },
                // 其他設備...
            },
            "key": "**16 個隨機字元轉十六進位字串, 共 32 HEX 字元**",
            "token": "__身份驗證令牌__"
        },
        // 其他模組...
    }
    ```

1. 儲存雲端伺服器通訊所需資料:

    ```js
    "server": {
        "s_id": "__自定伺服器ID__",
        "key": "**16 個隨機字元轉十六進位字串, 共 32 HEX 字元**",
        "token": "__身份驗證令牌__"
    }
    ```

1. 情境:

    ```js
    "action": {
        "id": "**模組ID+設備ID+功能ID**",
        "delay": 0,         // 執行前延遲時間，單位: 1/10 秒
        "value": "**值**"
    }

    "scenes": {
        "**情境ID**": [   // actions: 依順序執行
            <action>,
            // 其他 action ...
        ],
        // 其他情境...
    }
    ```

    * 同一情境重複執行時會先中止先前的才開始執行。
    <br>

1. 智慧控制:

    ```js
    "wisdoms": {    // 智慧控制物件
        "**智慧控制ID**": {
            "active": true                      // 啟用或停用
            "states": [ "**狀態ID**", ... ],    // 依順序執行狀態機
        },
        // 其他智慧控制...
    }

    "states": {     // 狀態機物件
        "**狀態機ID**": {
            "condition": {  // 要滿足的條件
                "vars": [ "**模組ID+設備ID+功能ID duration**", ... ],
                "expr": "**條件運算式**"         // 以 `$1...$n` 表示對應 vars[] 的 `模組ID+設備ID+功能ID` 狀態值
            },
            "run": {        // 滿足條件後執行命令
                "actions": [    // 依順序執行
                    <action>,
                    // 其他 action ...
                ],
                "scenses": [ "**情境ID**", ... ]
            },
            "delay": 0                      // 延遲時間之後才結束本狀態機，單位: 1/10 秒
        },
        // 其他狀態機...
    }
    ```

    * 智慧控制的 `active` 設為 `false` 表示平常停用，但在排程指定的時間範圍內會自動啟用之。
    * 持續時間 (`duration`，單位: 1/10 秒) 指 `模組ID+設備ID+功能ID` 在系統中記錄最後值的持續時間。
    * 持續時間若要以進入現在狀態機才開始計算的話，請在時間前加上一個 `+`。
    * 狀態機 `run` 中的 `actions`、`scenses` 同時存在的話，會以併行方式開始執行。
    * 狀態機 `delay` 是指 `run` 開始執行起計算的延遲時間，並非 `run` 執行完後的延遲時間。
    <br>

1. 排程:

    ```js
    "schedules" : {
        "**排程ID**": {
            "active": true,     // 是否啟用
            "timer": {
                "date_start": "",       // YYYY-MM-DD: 起始日期
                "date_end": "",         // YYYY-MM-DD: 結束日期
                "weeks": [],            // 0~6: 週日~週六
                "months": [],           // 1~12 月
                "days": [],             // 1~31 日
                "hours": [],            // 0~23 時
                "minutes": []           // 0~59 分
            },
            "run": {
                "actions": [    // 依順序執行
                    <action>,
                    // 其他 action ...
                ],
                "scenses": [ "**情境ID**", ... ],
                "wisdoms": [ "**智慧控制ID**", ... ]
            }
        },
        // 其他排程...
    }
    ```

    * `timer` 中的 (`date_start`, `date_end`, `days`, `weeks`, `hours`) 可以省略或以空值表示之。
    * `timer.minutes` 至少要指定一個值。
    * `run` 至少要指定 `actions`、`scenses`、`wisdoms` 其中一項。
    * `run.wisdoms` 表示在指定的時間範圍啟用。
